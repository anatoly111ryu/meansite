<div id="packages-overview">
  <h2>Packages Overview</h2>

  <p>The mean.io package system allows developers to create modular code that provides useful tools that other mean developers can use. The packages, when published, are plug-and-play and are used in a way very similar to traditional npm packages.</p>

	<p>The meanio package system integrates all the packages into the mean project as if the code was part of mean itself and provides the developers with all the necceesary tools required to integrate their package into the host project.</p>

	<p>There are two types of packages:</p>
	<ul>
		<li>
			<p><b>Custom</b> Packages are generated by the mean scaffolder and contain most of your application logic. Custom packages are found in <i>/packages</i> and can be published as a contrib package for use by other developers.</p>
		</li>
		<li>
			<p><b>Contrib</b> Packages are installed by the mean installer and are found at <i>/node_modules</i>. Contrib packages are "plug and play".</p>
		</li>
	</ul>

	<p class="alert alert-info">The label <span class="label label-info">Abstraction</span> indicates functionality managed by the package system.</p>
</div>

<div id="packages-first">
  <h2>Your First Package</h2>

	<p>Mean.io comes with its own command line interface (CLI). The CLI provides a scaffolding function to create a default Package.</p>

	<p>From the root of your mean project issue the following command.</p>

	<style>.ace_editor { height: 55px;font-size:16px;}</style>
	<div ui-ace="{ mode:'text', theme:'monokai', FontSize:'18px'}" readonly="true">
		mean package myPackage;
	</div>

	<p>Restart your app and login. You will notice a link in the main menu to an example page.</p>

	<p class="alert alert-success">Congratulations you are now the official creator of a mean package! Your code can be found at <i>/packages/myPackage</i></p>
	<p class="alert alert-warning">Mean versions prior to 0.3.2 store packages in /node_modules</p>

</div>

<section id="packages-using">
  <h2>Using Packages</h2>

	<p>Mean packages can be used in two ways </p>

	<ol>
		<li>To provide some service such as token generation, inline editing, theme changing</li>
		<li>As a tool/library for other packages or your general code base</li>
	</ol>

	<h3>Installing a package</h3>

	<p>We will use "mean-tokens" as an example.<p>

	<p>From the root of your mean project issue the following command. All installed contrib packages are in <i>node_modules</i></p>

	<style>.ace_editor { height: 55px;font-size:16px;}</style>
	<div ui-ace="{ mode:'text', theme:'monokai', FontSize:'18px'}" readonly="true">
		mean install mean-tokens;
	</div>

	<p>Restart your app and login. You will notice a link in the main menu to an example page.</p>

	<p class="alert alert-success">Congratulations you successfully installed your first package!</p>

	<p class="alert alert-warning">Admin role is required to edit tokens. See the CLI section for how to assign roles to users or do <i>mean -h</i> from the command line.</p>

</section>

<section id="packages-fs">
	<h2>File Structure</h2>

	<p>The file structure is similar to that of the mean project itself.</p>

	<p>Fundamental Files at the <strong>root</strong> of the package</p>

	<span class="label label-info">server</span>
	<pre>
	app.js        # Packages are registered here
	package.json  # Defines package name, version and <i>mean=true</i>
	</pre>

	<p>All of the Server side code resides in the <strong>/server</strong> directory.</p>

	<span class="label label-info">server</span>
	<pre>
	Server
	--- config        # Configuration files
	--- controllers   # Server side logic goes here
	--- models        # Database Schema Models
	--- routes        # Rest api endpoints for routing
	--- views         # Swig based html rendering
	</pre>

	<p>All of the Client side code resides in the <strong>/public</strong> directory.</p>

	<span class="label label-info">client</span>
	<pre>
	public            # Anything in public is public assessible
	--- assets        # Javascript/Css/Images (not aggregated)
	--- controllers   # Angular Controllers
	--- config        # Contains routing files
	--- services      # Angular Services (there are also directive and filter folders)
	--- views         # Angular views
	</pre>

	<p class="alert alert-warning">All javascript within public is automatically aggregated with the exception of files in assets which can be manually added using the <i>aggregateAsset() </i> <span class="label label-info">abstraction</span> function</p>

	<p class="alert alert-info">Files within public of the package can be accessed externally /[package-name]/path-to-file-relative-to-public for example to access tokens angular controller tokens/controllers/tokens.js</p>

</section>


<section id="packages-register">
	<h2>Registering a Package</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>

	<p> </p>

	<p>In order for a Package to work it needs to be registered. By doing this you make package system aware that you are ready and that other packages are able to depend on you. The packages are registered from within <i>app.js</i></p>

	<p>When registering you are required to declare all your dependencies in order for the package system to make them
	available to your package.</p>

	<style>#register-example { height: 120px;font-size:16px;}</style>
	<div id="register-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	// Example of registering the MyPackage
	MyPackage.register(function(app, auth, database) {

	});
	</div>

	<p>MEAN has 3 pre registered dependencies. <i>app</i> which makes the express app available <i>auth</i> which has some basic authentication functions and <i>database</i> which contains the mongoose database connection.</p>

	<p class="alert alert-warning">All dependencies specified must be registered in order to use them</p>

</section>

<section id="packages-dependencies">
	<h2>Dependency Injection</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>

	<p><blockquote><i>An injection is the passing of a dependency (a service) to a dependent object (a client). The service is made part of the client's state. Passing the service to the client, rather than allowing a client to build or find the service, is the fundamental requirement of the pattern. - <a href="http://en.wikipedia.org/wiki/Dependency_injection">wikipedia</a></i></blockquote></p>

	<p>Dependency injection allows you to declare what dependencies you require and rely on the package system to resolve all dependencies for you. Any package registered is automatically made available to anyone who would like to depend on them.</p>

	<p>Looking again at the registration example we can see that MyPackage depends on the Tokens and can make use of it full functionality including overriding it.</p>

	<style>#dependency-example { height: 220px;font-size:16px;}</style>
	<div id="dependency-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	// Example of registering the tokens package
	MyPackage.register(function(app, auth, database, Tokens) {
		//I can make use of the tokens within my module
		MyPackage.someExampleFunction('some paramater');

		//I can override functions
		MyPackage.someExampleFunction = function(param) {
			//my custom logic goes here
		};
	});
	</div>

	<p class="alert alert-info">Packages when in code are used in a capitalized form</p>

</section>

<section id="packages-angular-deps">
	<h2>Angular Modules and Dependencies</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>
	<p> </p>
	<p>Every package registration automatically creates a corresponding angular module of the form <i>mean.[package-name]</i></p>

	<p>The package system injects this information into the mean init functions and allows developers to base their controllers, services, filters, directives etc on either an existing module or on their own one.</p>

	<p>In addition you are able to declare which angular dependencies you want your angular module to use.</p>

	<p>Below is an example of adding an angular dependency to our angular module.</p>

	<style>#angular-dep-example { height: 100px;font-size:16px;}</style>
	<div id="angular-dep-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	// Example of adding an angular dependency of the ngDragDrop to the
	MyPackage.angularDependencies(['ngDragDrop']);
	</div>

	<p class="alert alert-info">See the assets section for an example how to add external libraries to the client such as the ngDragDrop javascript library</p>

</section>

<section id="packages-assets">
	<h2>Assets and Aggregation</h2>

  <span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>

	<p>All assets such as images, javascript libraries and css stylesheets should be within <i>public/assets</i> of the package file structure.</p>

	<p>Javascript and css from <i>assets</i> can be aggregated to the global aggregation files. By default all javascript is automatically wrapped within an anonymous function unless given the option <i>{global:true}</i> to not enclose the javascript within a contained scope.</p>

	<style>#assets-example { height: 220px;font-size:16px;}</style>
	<div id="assets-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">

	//Adding jquery to the mean project
	MyPackage.aggregateAsset('js','jquery.min.js');

	//Adding another library - global by default is false
	MyPackage.aggregateAsset('js','jquery.min.js', {global:true});

	//Adding some css to the mean project
	MyPackage.aggregateAsset('css','default.css');
	</div>

	<p class="alert alert-warning">Javascript files outside of assets are automatically aggregated and injected into the mean project. As a result libraries that you do not want aggregated should be placed within public/assets/js</p>
</section>

<section id="packages-settings">
	<h2>Settings Object</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>
	<p> </p>
	<p>The settings object is a persistance object that is stored in the packages collection and allows for saving persistant information per package such as configuration options or admin settings for the package.</p>

	<style>#settings-example { height: 320px;font-size:16px;}</style>
	<div id="settings-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">

	//Receives two arguments the first being the settings object the second
	//is a callback function
    MyPackage.settings({'someSetting':'some value'},function (err, settings) {
      //you will receive the settings object on success
    });

    // Another save settings example this time with no callback
    // This writes over the last settings.
    MyPackage.settings({'anotherSettings':'some value'});

    // Get settings. Retrieves latest saved settigns
    MyPackage.settings(function (err, settings) {
      //you now have the settings object
    });
	</div>

	<p class="alert alert-warning">Each time you save settings you overwrite your previous value. Settings are designed to be used to store basic configuration options and should not be used as a large data store</p>
</section>

<section id="packages-express-routes">
	<h2>Express Routes</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>
	<p> </p>
	<p>All routing to server side controllers is handled by express routes. The package system uses the typical express
	approach. The package system has a route function that passes along the package object to the main routing file typically <i>server/routes/index.js</i></p>

	<p>Example from the <b>app.js</b></p>
	<style>#express1-example { height: 90px;font-size:16px;}</style>
	<div id="express1-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	//By default the Package Object is passed to the routes along withe the other arguments
	MyPackage.routes(app, auth, database);
	</div>

	<p>Example from the <b>server/routes/index.js</b></p>
	<style>#express2-example { height: 210px;font-size:16px;}</style>
	<div id="express2-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	// The Package is past automatically as first parameter
	module.exports = function(MyPackage, app, auth, database) {

		//example route
		app.get('/myPackage/example/anyone', function (req,res,next) {
			res.send('Anyone can access this');
		});

	};
	</div>
</section>

<section id="packages-angular-routes">
	<h2>Angular Routes</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Client</span>
	<p> </p>
	<p>The angular routes are defined in <i>public/config/routes</i>. Just like the latest version of mean, the packages
	use the <i>$stateProvider</i></p>

	<style>#angular-example { height: 130px;font-size:16px;}</style>
	<div id="angular-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	$stateProvider
		.state('myPackage example page', {
			url: '/myPackage/example',
			templateUrl: 'myPackage/views/index.html'
		});
	</div>

	<p class="alert alert-info">The angular views are publically accessible via templateUrl when prefixed with the package name</p>
</section>

<section id="packages-menus">
	<h2>Menu System</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>

	<p>Packages are able to hook into an existing menu system and add links to various menus integrated within mean.</p>

	<p>Each link specifies its <i>title, template, menu and role</i> that is allowed to see the link. If the menu specified does not exist a new menu will be created. The menu object is made accessible within the client by means of a <i>menu angular service</i> that queries the menu controller for information about links.</p>

	<p>Below is an example how to add a link to the main menu from <i>app.js</i></p>

	<style>#menu1-example { height: 180px;font-size:16px;}</style>
	<div id="menu1-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	//We are adding a link to the main menu for all authenticated users
	MyPackage.menus.add({
		title: "myPackage example page",
		link: "myPackage example page",
		roles: ["authenticated"],
		menu: "main"
	});
	</div>

	<p class="alert alert-info">You can look at the angular header controller in the mean project for more info. You can find it <i>public/system/controllers/header.js</i> and see how the menu service is implemented</p>
</section>

<section id="packages-rendering">
	<h2>Html View Rendering</h2><span class="label label-info">Abstraction</span>|<span class="label label-info">Server</span>
	<p> </p>

	<p>The packages come built in with a rendering function allowing packages to render static html. The default templating engine is <i>swig</i>. The views are found in <i>server/views</i> of the package and should end with the .html suffix</p>

	<p>Below is an example rendering some simple html></p>

	<style>#render1-example { height: 160px;font-size:16px;}</style>
	<div id="render1-example"ui-ace="{ mode:'javascript', theme:'monokai'}" readonly="true">
	app.get('/myPackage/example/render', function (req,res,next) {
		MyPackage.render('index', {packageName:'myPackage'}, function (err, html) {
			//Rendering a view from the Package server/views
			res.send(html);
		});
	});
	</div>
</section>


<section id="packages-publishing">
  <h2>Publishing your packages</h2>

  <p>Congratulations! You have made a custom package and now you want to share it with the MEAN community</p>

  <p>Publishing your package involves a few simple steps but when done your custom package will be reborn into an awesome contrib package!</p>

  <ol>
  	<li>
  		Test it well!
  	</li>
  	<li>
  		Make sure all dependencies are available and you do not rely on custom code that is not part of your project.
  	</li>
  	<li>
  		Make sure no other contrib package uses the same name.
  	</li>
  	<li>
  		Ensure your package.json contains all the dependencies.
  	</li>
  	<li>
  		Prepare a good README file that explains other mean contrib packages that may be required and has basic install and setup instructions.
  	</li>
  	<li>
  		Host it on GitHub, publish it to npm and let us know about it. If we like the custom package, we may integrate it as an official MEAN module.
  	</li>
  </ol>

  <p>Our goal is to build the most amazing development platform around an awesome active community. Your packages are the
  	building blocks to this vision and with your help, mean will continue to grow and improve.</p>

  <p>Catch us on IRC, open an issue or email us if you need some help, advice or just want to share something cool!</p>
</section>
